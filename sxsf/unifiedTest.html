<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <!-- 禁止缩放 -->
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <!-- Add to homescreen for Chrome on Android -->
        <!-- 移动端禁止识别电话邮箱 -->
        <meta name="format-detection" content="telephone=no" />
        <meta content="email=no" name="format-detection" />
        <!-- SEO -->
        <meta name="description" content="">
        <meta name="keywords" content="">
        <title>统一考试</title>
        <link rel="stylesheet" type="text/css" href="static/style/style.css" />
    </head>
    <body >
        <div class="page rulePage" style="display:none;" >
            <h1>绍兴司法普法统一考试</h1>
            <p class="explain">
                为深入开展“七五”普法，推进“法润绍兴”行动，进一步增强各级领导干部和广大公务员依法决策、依法行政、依法办事的能力，根据市委、市政府《绍兴市普法教育领导小组关于在全市公民中开展法治宣传教育的第七个五年规划（2016—2020年）》（绍市委发〔2016〕54号）文件要求和市普法办《关于进一步加强国家工作人员、青少年、企业经营管理人员和外来务工人员学法用法的实施意见》（绍市普法办〔2016〕20  号），今年将进一步强化领导干部和公务员学法用法考试机制。
            </p>
            <div class="ruleTitle">
                
            </div>
            <div class="ruleTxet">
                <h3>一.考试对象</h3>
                <p>
                    全市市管领导干部和市直单位公务员（含参公人员）常规考试积分累计不满80分的进行统一考试。
                </p>
                <h3>二、考试内容</h3>
                <p>
                    十八大、十八届三中、四中、五中、六中全会精神、宪法、法律法规、党章党规与社会主义法治理念等相关知识。
                </p>
                <h3>三、考试时间</h3>
                <p>
                    1、微信学法用法考试每年一次，九月的15-25日期间登录均可参加考试。
                    2、考试题目共50题，每题2分，每期答题有3次机会，每次答题后按最高分计，80分（含）以上合格。
                </p>
                <h3>四、注意事项</h3>
                <p>
                    1、答题前，请选择单位及所在区域，并填写姓名、联系电话方可开始答题。
                    2、考试不限次数，系统将记录最高成绩。
                </p>
            </div>
            <button class="buttonUI ok">
                确定
            </button>
        </div>
        <div class="page loginPage"  >
            <h1>绍兴司法普法统一考试</h1>
            <div class="formBox">
                <div class="item" >
                    <h4 class="title">单位所在地区*</h4>
                    <div class="selectUI" >
                        <div class="default" id="areaInput" data-status="close" >
                            <span>请选择单位所在地区</span>
                            <i class="icon"></i>
                        </div>
                        <ul style="z-index:20;">
                           <li>
                               越城区
                           </li>
                           <li>
                               江干区
                           </li>
                           <li>
                               徐虎躯
                           </li>
                           <li>
                               拱墅区
                           </li>
                           <li>
                               滨江区
                           </li>
                           <li>
                               越城区
                           </li>
                           <li>
                               江干区
                           </li>
                           <li>
                               徐虎躯
                           </li>
                           <li>
                               拱墅区
                           </li>
                           <li>
                               滨江区
                           </li>
                        </ul>
                        
                        <input type="hidden" name="area" id="area" data-default="请选择单位所在地区"/>
                    </div>
                </div>
                <div class="item" >
                    <h4 class="title">单位*</h4>
                    <div class="selectUI" >
                        <div class="default" id="agencyInput" data-status="close">
                           <span>请选择单位</span>
                           <i class="icon" style="z-index:11;"></i>
                       </div >
                        <ul>
                           
                           <li>
                               越城区
                           </li>
                           <li>
                               江干区
                           </li>
                           <li>
                               徐虎躯
                           </li>
                           <li>
                               拱墅区
                           </li>
                           <li>
                               滨江区
                           </li>
                        </ul>
                        <input type="hidden" name="agency" id="agency" data-default="请选择单位" />
                    </div>
                </div>
                <div class="item" >
                    <h4 class="title">姓名*</h4>
                    <div class="inputUI">
                        <input type="text" placeholder="请输入你的姓名" name="name" id="name" />
                    </div>
                </div>
                <div class="item" >
                    <h4 class="title">联系电话*</h4>
                    <div class="inputUI">
                        <input type="text" placeholder="请输入你的联系电话" name="phone" id="phone"/>
                    </div>
                </div>
            </div>
            <button class="buttonUI show startTest">
                开始答题
            </button>
        </div>
        <div class="page testPage" style="display:none" >
            <div class="box">
                <h3 class="type">【单选题】<span class="current">5</span><span>/</span><span class="sum">20</span></h3>
                <p class="question">
                    1.问题问题问题问题问题问题问题问题问题问题问题问题问题
                </p>

                <ul class="selectBox">
                    <li>
                        <div class="selectOption">
                            <div class="radioUI">
                                <div class="red">
                                    
                                </div>
                                <input type="radio"/>
                            </div>
                            <span>
                                A.选项选项选项选项选项选项
                            </span>
                        </div>
                    </li>
                     <li>
                        <div class="selectOption">
                            <div class="radioUI">
                                <div class="red">
                                    
                                </div>
                                <input type="radio"/>
                            </div>
                            <span>
                                A.选项选项选项选项选项选项
                            </span>
                        </div>
                    </li>
                     <li>
                        <div class="selectOption">
                            <div class="radioUI">
                                <div class="red">
                                    
                                </div>
                                <input type="radio"/>
                            </div>
                            <span>
                                A.选项选项选项选项选项选项
                            </span>
                        </div>
                    </li>
                    <li class="noBorder">
                        <div class="selectOption clearfix">
                            <div class="radioUI fl">
                                <div class="red">
                                    
                                </div>
                                <input type="radio"/>
                            </div>
                            <span class="fl">
                                A.选项选项选项选项选项选项
                                选项选项选项选项选项选项
                                选项选项选项选项选项选
                            </span>
                        </div>
                    </li>
                </ul>
                <div class="buttonBox clearfix">
                    <button class="buttonUI fl ">
                        上一题
                    </button>
                    <button class="buttonUI fr show" >
                        下一题
                    </button>
                </div>
                
            </div>
        </div>
        <div class="page finishPage" style="display:none;"  >
            <h1>绍兴司法普法统一考试</h1>
            <div class="content">
                <h4 class="title">本次统一考试的成绩</h4>
                <p class="score"><span>80</span>分</p>
                <p class="remainder">(考试结束，感谢您的参与)</p>
                <button class="buttonUI again">再考一次</button>
                <button class="buttonUI checkout show ">查看答题</button>
            </div>
        </div>
        <div class="page resultPage"  style="display:none;"  >
            <h1>本次考试答题情况</h1>
            <div class="box">
                <div class="resultItem">
                    <h3 class="type">【单选题】</h3>
                    <p class="question">
                        1.问题问题问题问题问题问题问题问题问题问题问题问题问题
                    </p>

                    <ul class="resultSelectBox">
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI right">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                    
                    </ul>
                    <p class="wrongOption">您的错误选项是：B</p>
                    <div class="hr"></div>
                </div>
                <div class="resultItem">
                    <h3 class="type">【单选题】</h3>
                    <p class="question">
                        1.问题问题问题问题问题问题问题问题问题问题问题问题问题
                    </p>

                    <ul class="resultSelectBox">
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI right">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                    
                    </ul>
                    <p class="wrongOption">您的错误选项是：B</p>
                    <div class="hr"></div>
                </div>
                <div class="resultItem">
                    <h3 class="type">【单选题】</h3>
                    <p class="question">
                        1.问题问题问题问题问题问题问题问题问题问题问题问题问题
                    </p>

                    <ul class="resultSelectBox">
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI right">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                    
                    </ul>
                    <p class="wrongOption">您的错误选项是：B</p>
                    <div class="hr"></div>
                </div>
                <div class="resultItem">
                    <h3 class="type">【单选题】</h3>
                    <p class="question">
                        1.问题问题问题问题问题问题问题问题问题问题问题问题问题
                    </p>

                    <ul class="resultSelectBox">
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI right">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                        <li>
                            <div class="selectOption">
                                <div class="radioUI">
                                </div>
                                <span>
                                    A.选项选项选项选项选项选项
                                </span>
                            </div>
                        </li>
                    
                    </ul>
                    <p class="wrongOption">您的错误选项是：B</p>
                </div>
            </div>
            <div class="buttonBox clearfix">
                    <button class="buttonUI fl again ">
                        再考一次
                    </button>
                    <button class="buttonUI fr" >
                        我知道了
                    </button>
            </div>
        </div>
        <!-- 遮罩 -->
        <div class="mask" style="display:none">
            
        </div>
         <!-- 提交答卷 -->
        <div class="alertUI submit" style="display:none">
            <p class="tip">确定提交答卷？</p>
            <div class="buttonBox">
                <span class="cancel">取消</span>
                <span class="noBorder confirm">确定</span>
            </div>
        </div>
        <!-- 开始新一轮考试 -->
        <div class="alertUI testAgain" style="display:none;">
            <p class="tip">开始新一轮考试？</p>
            <div class="buttonBox">
                <span class="cancel">取消</span>
                <span class="noBorder confirm">确定</span>
                <span class="noBorder ">确定</span>
            </div>
        </div>
        <!-- 合格无需参加考试 -->
        <div class="runOut alertUI" style="display:none">
            <p class="tip">恭喜！您已合格，无需参加本次考试。</p>
            <div class="buttonBox" >
                我知道了
            </div>
        </div>
    </body>

     <div class=" fail alertUI"  style="display:none;">
            <p class="tip">
            <span>
                恭喜！您已合格，无需参加本次考试。
            </span>
            </p>
            <div class="buttonBox">
                我知道了
            </div>
        </div>
    <script type="text/javascript">
        // 响应式处理
        function responsive(){
                var width=document.body.clientWidth;//获取文档即视口的宽度
                document.getElementsByTagName("html")[0].style.fontSize=(width/18.75)+"px";//设置html文 字大小为40px;
        }
        responsive();
        window.onresize=function(){
            responsive();
        }



        function responsive(){
            var width=document.body.clientWidth;
            document.getElementsByTagName("html")[0].style.fontSize=(width/18.6)+"px";
        }
        responsive();
        window.onresize=function(){
            responsive();
        }
    </script>
    <script type="text/javascript" src="static/js/zepto.min.js"></script>
    <script type="text/javascript" src="static/js/touch.js"></script>
   <script type="text/javascript" src="static/js/common.js"></script>
   <script type="text/javascript">
   
         
    // 再考一次-取消
    $('.testAgain .cancel').bind("touchstart", function (event) {
            event.preventDefault();
            $(this).addClass('active');

           $('.testAgain .cancel').bind("touchend", function (event) {
             $(this).removeClass('active');
             $(this).parents('.testAgain').css('display','none');
             $('.mask').css('display','none');
           }); 
     });
    // 再考一次-确定
    $('.testAgain .confirm').bind("touchstart", function (event) {
            event.preventDefault();
            $(this).addClass('active');
            $(this).siblings('.cancel').css('borderColor',"#d0d0d0");
           $('.testAgain .confirm').bind("touchend", function (event) {
                $(this).siblings('.cancel').css('borderColor',"#999");
                $(this).removeClass('active');
                $(this).parents('.testAgain').css('display','none');
                $('.mask').css('display','none');

                loginAjax();

           }); 
     });


    //提交答卷-取消
    $('.submit .cancel').bind("touchstart", function (event) {
            event.preventDefault();
            $(this).addClass('active');

           $('.submit .cancel').bind("touchend", function (event) {
             $(this).removeClass('active');
             $(this).parents('.submit').css('display','none');
             $('.mask').css('display','none');
           }); 
     });

    //提交答卷-确定
    $('.submit .confirm').bind("touchstart", function (event) {
            event.preventDefault();
            $(this).addClass('active');
            $(this).siblings('.cancel').css('borderColor',"#d0d0d0");
           $('.submit .confirm').bind("touchend", function (event) {
                $(this).siblings('.cancel').css('borderColor',"#999");
                $(this).removeClass('active');
                 $(this).parents('.submit').css('display','none');
                 $('.mask').css('display','none');
                 confirmSubmit();
           }); 
     });
    
    // 登陆界面弹出框
     $('.fail .buttonBox').bind("touchstart", function (event) {
            event.preventDefault();
            $(this).addClass('active');
     });
     $('.fail .buttonBox').bind("touchend", function (event) {
         $(this).removeClass('active');
         $(this).parents('.fail').css('display','none');
         $('.mask').css('display','none');
       }); 

    // ===========
    // button模块
    // ===========
    // 首页确定进入登录页
    $(".ok").click(function(){
        $(this).parents('.page').css('display','none').next('.loginPage').css('display','block');
    });

    //登陆的表单验证
    var singleItem=[];
    var judgeItem=[];
    var multipleItem=[];
    var phone;
    var change_left;
    var loginData;
    function loginAjax(){
        $.ajax({
              type: 'POST',
              url: 'http://192.168.0.108:8080/sxsf/tyks/login',
              data:loginData,
              dataType: 'json',
              timeout: 300,
              success: function(data){
                console.log(data)
                if(data.meta.success){
                    if(data.data.is_passed){
                        //通过
                        $(".fail").show();
                    }else{
                        //没有通过
                        singleItem=data.data.single;//单选题数组
                        judgeItem=data.data.judge;//判断题数组
                        multipleItem=data.data.multiple;//多选题数组
                        
                        var itemNum=singleItem.length+judgeItem.length+multipleItem.length;//总题数
                        var judgeTemplate="";
                        var multipleTemplate="";
                        var singleTemplate="";
                        var template="";



                        // 判断题循环
                       for(var i=0;i<judgeItem.length;i++){
                            // console.log(singleItem[i].question);//题目
                            var selectItem=$.parseJSON(judgeItem[i].selectItem);

                            judgeTemplate+='<div class="box" qid='+judgeItem[i].id+' data-type='+judgeItem[i].questionType+'><h3 class="type">【判断题】<span class="current">5</span><span>/</span><span class="sum">'+itemNum+'</span></h3><p class="question">'+judgeItem[i].question+'</p><ul class="selectBox single"><li data-checked="0"><div class="selectOption"><div class="radioUI"><div class="red"></div><input type="radio"/></div><span>A&nbsp;'+selectItem["1"]+'</span></div></li><li data-checked="0"><div class="selectOption clearfix"><div class="radioUI fl"><div class="red"></div><input type="radio"/></div><span class="fl">B&nbsp;'+selectItem["2"]+'</span></div></li></ul><div class="buttonBox clearfix"><button class="buttonUI fl">上一题</button><button class="buttonUI fr show" >下一题</button></div></div>'
                        }
                        //多选题循环
                        for(var i=0;i<multipleItem.length;i++){
                            // console.log(singleItem[i].question);//题目
                            var selectItem=$.parseJSON(multipleItem[i].selectItem);

                            multipleTemplate+='<div class="box"  qid='+multipleItem[i].id+' data-type='+multipleItem[i].questionType+'><h3 class="type">【多选题】<span class="current">5</span><span>/</span><span class="sum">'+itemNum+'</span></h3><p class="question">'+multipleItem[i].question+'</p><ul class="selectBox multiple"><li data-checked="0"><div class="selectOption"><div class="radioUI"><div class="red"></div><input type="radio"/></div><span>A&nbsp;'+selectItem["1"]+'</span></div></li><li data-checked="0"><div class="selectOption"><div class="radioUI"><div class="red"></div><input type="radio"/></div><span>B&nbsp;'+selectItem["2"]+'</span></div></li><li data-checked="0"><div class="selectOption"><div class="radioUI"><div class="red"></div><input type="radio"/></div><span>C&nbsp;'+selectItem["3"]+'</span></div></li><li data-checked="0"><div class="selectOption clearfix"><div class="radioUI fl"><div class="red"></div><input type="radio"/></div><span class="fl">D&nbsp;'+selectItem["4"]+'</span></div></li></ul><div class="buttonBox clearfix"><button class="buttonUI fl">上一题</button><button class="buttonUI fr show" >下一题</button></div></div>'
                        }

                        //单选题循环
                        for(var i=0;i<singleItem.length;i++){
                            // console.log(singleItem[i].question);//题目
                            var selectItem=$.parseJSON(singleItem[i].selectItem);

                            singleTemplate+='<div class="box" qid='+singleItem[i].id+'  data-type='+singleItem[i].questionType+'><h3 class="type">【单选题】<span class="current">5</span><span>/</span><span class="sum">'+itemNum+'</span></h3><p class="question">'+singleItem[i].question+'</p><ul class="selectBox single"><li data-checked="0"><div class="selectOption"><div class="radioUI"><div class="red"></div><input type="radio"/></div><span>A&nbsp;'+selectItem["1"]+'</span></div></li><li data-checked="0"><div class="selectOption"><div class="radioUI"><div class="red"></div><input type="radio"/></div><span>B&nbsp;'+selectItem["2"]+'</span></div></li><li data-checked="0"><div class="selectOption"><div class="radioUI"><div class="red"></div><input type="radio"/></div><span>C&nbsp;'+selectItem["3"]+'</span></div></li><li data-checked="0"><div class="selectOption clearfix"><div class="radioUI fl"><div class="red"></div><input type="radio"/></div><span class="fl">D&nbsp;'+selectItem["4"]+'</span></div></li></ul><div class="buttonBox clearfix"><button class="buttonUI fl">上一题</button><button class="buttonUI fr show" >下一题</button></div></div>'
                        }

                        template=judgeTemplate+multipleTemplate+singleTemplate;
                        $(".testPage").html(template);

                        for(var j=1;j<itemNum+1;j++){
                            $(".testPage .box").eq(j-1).find(".current").html(j);                                   
                         }
                            
                        
                        $('.loginPage').hide().siblings('.testPage').show().siblings('.finishPage ').hide().siblings('.resultPage').hide();
                        $(".testPage .box").eq(0).addClass("first").show().siblings('.box').hide();
                        $(".testPage .box").last().find(".buttonUI.fr").html("交卷").addClass('submitButton');


                        Select();
                        changeItem();
                        submitPaper();




                        

                    }


                

                }else{
                    $(".fail").show().find(".tip").html(data.meta.message);
                    $(".mask").show();
                }
                // console.log(data)
              },
              error: function(xhr, type){
                alert('Ajax error!')
              }
            })
    }
    function login(){

        $('.startTest').click(function(){
             //让下拉框回收
            $('.selectUI ul').css("display","none");
            $('.selectUI .default').data('status',"close");
            $('.selectUI').removeClass('open')
            // console.log(typeof $("#iphone").val());
                $('#area').val($.trim($('#areaInput').text()));
                $('#agency').val($.trim($('#agencyInput').text()));
                $('input[type="hidden"]').each(function(i){
                    if($(this).val()==$(this).data("default")){
                        $(this).parents(".selectUI").addClass('empty');
                    }else{
                        $(this).parents(".selectUI").removeClass('empty');
                    }  
                }); 

                $("input[type='text']").each(function(){
                    if($(this).val() == ""){
                        $(this).parents(".inputUI").addClass('empty');
                    }else{
                        $(this).parents(".inputUI").removeClass('empty');
                    }
                }); 

               if(!(/^1[34578]\d{9}$/.test($("#phone").val()))){ 
                    $("#phone").parents(".inputUI").addClass('empty') 
                    return false; 
                }else{
                    $("#phone").parents(".inputUI").removeClass('empty')
                }


                if($('.empty').length==0){
                    var areaVal=$("#area").val();
                    var agencyVal=$("#agency").val();
                    var nameVal=$("#name").val();
                    var phoneVal=$("#phone").val();
                    phone=$("#phone").val();
                    var data={"area":areaVal,"agency":agencyVal, "name": nameVal,"phone":phoneVal}
                    var a=$.param({name:'何方',areaId:1,agencyId:1,phone:phoneVal});
                    loginData=a;
                    // console.log(areaVal+","+agencyVal+","+nameVal+","+phoneVal);
                    // console.log(loginData)
                    // console.log($.param(data));

                    // 重置
                    $('input[type="hidden"]').each(function(i){
                        $(this).siblings('.default').find('span').text($(this).data("default")).removeClass('checked');
                    }); 
                    $("input[type='text']").each(function(){
                        $(this).val("");
                    }); 
                    //成功请求ajax;
                    loginAjax(); 
                    
                  

                                     
                }
        });
    }
    login();


  // 提交数据
    var singleAnswer=[];
    var multipleAnswer=[];
    var judgeAnswer=[];

    var data=[];
    //上一题，下一题
    function changeItem(){
        //上一题
       $(".buttonBox .fl").click(function(){
            var _this=$(this).parents('.box');
            var answer=[];//答案
            var submitData={};
            var qid=parseInt(_this.attr("qid")); 
            var qType=_this.data("type");
            console.log(qid)
            console.log( typeof qType)              


            $(this).parents(".buttonBox").siblings('.selectBox').find('li').each(function(i){
                if($(this).data("checked")=="1"){
                    answer.push(++i);

                }                  
            });

            

            submitData.qid=qid;
            submitData.answer=answer;
            submitData.qType=qType;

            console.log(submitData);
            
            var le=data.length;
            var isExist=false;
            //循环查找是否存在
            for(var i=0;i<le;i++){
                //存在
                if(submitData.qid==data[i].qid){
                    data[i].answer=submitData.answer;
                    isExist=true;
                    break;
                }                    
            }
            //不存在
            if(isExist==false){
                data.push(submitData);
            }

            $(this).parents('.box').not(".first").hide().prev(".box").show();
            // console.log(data)

       });
        
        //下一题
       $(".buttonBox .fr").click(function(){
            var _this=$(this).parents('.box');
            var answer=[];//答案
            var submitData={};
            var qid=parseInt(_this.attr("qid")); 
            var qType=_this.data("type");

            $(this).parents(".buttonBox").siblings('.selectBox').find('li').each(function(i){
                if($(this).data("checked")=="1"){
                    answer.push(++i);

                }                  
            });

           

            submitData.qid=qid;
            submitData.answer=answer;
            submitData.qType=qType;

            console.log(submitData);
            var le=data.length;
            var isExist=false;
            //循环查找是否存在
            for(var i=0;i<le;i++){
                //存在
                if(submitData.qid==data[i].qid){
                    data[i].answer=submitData.answer;
                    isExist=true;
                    break;
                }                    
            }
            //不存在
            if(isExist==false){
                data.push(submitData);
            }
       
            // 是否为最后一题
            if($(this).attr("class").indexOf('submitButton') != -1){
                submitPaper();
            }else{
                $(this).parents('.box').hide().next(".box").show();
            }
       });
    }
    


    //交卷
    function submitPaper(){
        var remainderArr=[];
         $(".testPage .box .submitButton").click(function(){
            //查看是否有剩余题目
            $(".selectBox").each( function(index) {
                var answer=[];
                $(this).find('li').each(function(i){
                    if($(this).data("checked")=="1"){
                        answer.push(++i);

                    }
                });

                if(answer.length==0){
                    remainderArr.push(1)
                }
            });
            console.log(remainderArr);
            $(".mask").show();
            if(remainderArr.length>0){
                $(".submit").show().find(".tip").html("还有题未答，确定提交答卷？")
            }else{
                 $(".submit").show()
            }


            // 答案分类
             for(var index=0;index<data.length;index++){

                console.log(data[index])
                if(data[index].qType==1){
                    delete data[index].qType;
                    singleAnswer.push(JSON.stringify(data[index]))
                }else if(data[index].qType==2){
                    delete data[index].qType;                   
                    multipleAnswer.push(JSON.stringify(data[index]))
                }else if(data[index].qType==3){
                    delete data[index].qType;                  
                    judgeAnswer.push(JSON.stringify(data[index]))

                }
             }
             // console.log(singleAnswer);
             // console.log(multipleAnswer);
             // console.log(judgeAnswer);

         });

    }

    // 确定交卷
    function confirmSubmit(){
        var data=$.param({
            phone:phone,
            multiple:'['+multipleAnswer.join(",")+']',
            judge:'['+judgeAnswer.join(",")+']',
            single:'['+singleAnswer.join(",")+']'
        })
        console.log(data)

        $.ajax({
              type: 'POST',
              url: 'http://192.168.0.108:8080/sxsf/tyks/submit',
              data:data,
              dataType: 'json',
              timeout: 300,
            success: function(data){
                console.log(data)
                if(data.meta.success){
                    $(".testPage").hide().siblings(".finishPage").show().find(".score span").html(data.data.score);
                    singleResult=data.data.single;
                    multipleResult=data.data.multiple;
                    judgeResult=data.data.judge;


                    
                }else{
                    
                }

              },
              error: function(xhr, type){
                alert('Ajax error!')
              }
        })
    }
    
    


    // 再考一次    
    $(".again").click(function(){
        $('.testAgain').css('display','block').addClass('active');
        $('.mask').css('display','block');
    });


    //查看答题
    var singleResult=[];
    var multipleResult=[];
    var judgeResult=[];
   
    //工具方法  数组比较
    function isArrSame(arr1,arr2){
        var isSame=true;
        if(arr1.length==arr2.length){
            for(var i=0;i<arr1.length;i++){
                if(arr1[i]==arr2[i]){

                }else{
                    isSame=false;
                }
            }
            return isSame;
        }else{
            return false;
        }
    }
    function checkResult(){
        var singleResultTemplate="";
        var multipleResultTemplate="";
        var judgeResultTemplate="";
        var resultTemplate="";

        $(".checkout").click(function(){

            //单选
            for(var i=0;i<singleItem.length;i++){
                var selectItem=$.parseJSON(singleItem[i].selectItem);

                singleResultTemplate+='<div class="resultItem singleItem"><h3 class="type">【单选题】</h3><p class="question">'+singleItem[i].question+'</p><ul class="resultSelectBox"><li><div class="selectOption"><div class="radioUI"></div><span>'+selectItem["1"]+'</span></div></li><li><div class="selectOption"><div class="radioUI"></div><span>'+selectItem["2"]+'</span></div></li><li><div class="selectOption"><div class="radioUI "></div><span>'+selectItem["3"]+'</span></div></li><li><div class="selectOption"><div class="radioUI"></div><span>'+selectItem["4"]+'</span></div></li></ul><div class="hr"></div></div>'
            }

            //多选
            for(var i=0;i<multipleItem.length;i++){
                var selectItem=$.parseJSON(multipleItem[i].selectItem);

                multipleResultTemplate+='<div class="resultItem  multipleItem"><h3 class="type">【多选题】</h3><p class="question">'+multipleItem[i].question+'</p><ul class="resultSelectBox"><li><div class="selectOption"><div class="radioUI"></div><span>'+selectItem["1"]+'</span></div></li><li><div class="selectOption"><div class="radioUI"></div><span>'+selectItem["2"]+'</span></div></li><li><div class="selectOption"><div class="radioUI "></div><span>'+selectItem["3"]+'</span></div></li><li><div class="selectOption"><div class="radioUI"></div><span>'+selectItem["4"]+'</span></div></li></ul><div class="hr"></div></div>'
            }

            //判断
            for(var i=0;i<judgeItem.length;i++){
                var selectItem=$.parseJSON(judgeItem[i].selectItem);

                judgeResultTemplate+='<div class="resultItem judgeItem"><h3 class="type">【判断题】</h3><p class="question">'+judgeItem[i].question+'</p><ul class="resultSelectBox"><li><div class="selectOption"><div class="radioUI"></div><span>'+selectItem["1"]+'</span></div></li><li><div class="selectOption"><div class="radioUI"></div><span>'+selectItem["2"]+'</span></div></li></ul><div class="hr"></div></div>'
            } 

            resultTemplate=judgeResultTemplate+multipleResultTemplate+singleResultTemplate;
             $(".resultPage .box").html(resultTemplate);
            // 单选题
            $(".resultItem.singleItem").each(function(index) {
                var ringhtIndex1=parseInt(singleResult[index].rightAnswer[0])-1;
                $(this).find(".radioUI").eq(ringhtIndex1).addClass('right')
                if( isArrSame(singleResult[index].answer,singleResult[index].rightAnswer) ){

                }else{
                    var wrong1;
                    if(singleResult[index].answer[0]=="1"){
                        wrong1="A";
                    }else if(singleResult[index].answer[0]=="2"){
                        wrong1="B";
                    }else if(singleResult[index].answer[0]=="3"){
                        wrong1="C";
                    }else if(singleResult[index].answer[0]=="4"){
                        wrong1="D";

                    }else{
                        wrong1="";
                    }
                    $(this).find('.resultSelectBox').after('<p class="wrongOption">您的错误选项是：'+wrong1+'</p>')
                }
            });

            //多选题
            console.log(multipleResult)
            $(".resultItem.multipleItem").each(function(index) {
                var ringhtIndex2=[];
                var _this=$(this);
                multipleResult[index].rightAnswer.forEach(function(e){
                    ringhtIndex2.push(parseInt(e)-1);
                });
                ringhtIndex2.forEach(function(e){
                    _this.find(".radioUI").eq(e).addClass('right')
                });

                if(isArrSame(multipleResult[index].answer,multipleResult[index].rightAnswer)){

                }else{
                    var wrongStr;
                    var wrong2=[];
                    multipleResult[index].answer.forEach(function(e){
                        
                        if(e=="1"){
                            wrong2.push("A");
                        }else if(e=="2"){
                            wrong2.push("B");
                        }else if(e=="3"){
                            wrong2.push("C");

                        }else if(e=="4"){
                            wrong2.push("D");

                        }

                         
                       
                    });

                    wrongStr=wrong2.join(",");
                    $(this).find('.resultSelectBox').after('<p class="wrongOption">您的错误选项是：'+wrongStr+'</p>')
                    
                }
            });

            // 判断题
            $(".resultItem.judgeItem").each(function(index) {
                var ringhtIndex3=parseInt(judgeResult[index].rightAnswer[0])-1;
                $(this).find(".radioUI").eq(ringhtIndex3).addClass('right')

                if( isArrSame(judgeResult[index].answer,judgeResult[index].rightAnswer) ){

                }else{
                    var wrong3;
                    if(judgeResult[index].answer[0]=="1"){
                        wrong3="A";
                    }else if(judgeResult[index].answer[0]=="2"){
                        wrong3="B";
                    }else if(judgeResult[index].answer[0]=="3"){
                        wrong3="C";
                    }else if(judgeResult[index].answer[0]=="4"){
                        wrong3="D";

                    }else{
                        wrong3="";
                    }
                    $(this).find('.resultSelectBox').after('<p class="wrongOption">您的错误选项是：'+wrong3+'</p>')
                }
            });


            $(".finishPage").hide().siblings('.resultPage').show();


        });
    }
    checkResult();




   </script>
 
</html>